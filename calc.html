<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>Advanced Scientific Calculator</title>
  <link rel="icon" type="image/png" href="assets/calc.png">

  <style>
    :root {
      --bg: #0f1220;
      --panel: #171a2e;
      --btn: #262a45;
      --btn-accent: #3b82f6;
      --btn-warn: #ef4444;
      --text: #e5e7eb;
      --muted: #9aa0b4;
      --success: #22c55e;
      --shadow: 0 10px 25px rgba(0,0,0,0.35);
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100vh;
      margin: 0;
      background: radial-gradient(1200px 600px at 20% 0%, #151836 0%, var(--bg) 50%, #0b0e1a 100%);
      color: var(--text);
      font-family: Inter, system-ui, sans-serif;
      overflow: hidden; 
    }

    .app {
      height: 100vh;
      width: 100%;
      padding: 10px;
      display: flex;
      flex-direction: row;
      gap: 10px;
      justify-content: center;
    }

    .calc {
      background: linear-gradient(160deg, #1b1f38, var(--panel));
      border: 1px solid #242846;
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
      max-width: 600px;
      height: 100%; /* Fill container */
    }

    .screen {
      background: #0d1022;
      border: 1px solid #272b4a;
      border-radius: 10px;
      padding: 8px 12px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      flex: 0 0 18%; /* Screen takes 18% of vertical space */
      min-height: 60px;
    }

    .exp {
      font-size: clamp(10px, 1.5vh, 14px);
      color: var(--muted);
      text-align: right;
      word-break: break-all;
      overflow: hidden;
      margin-bottom: 2px;
    }

    .out {
      font-size: clamp(18px, 4.5vh, 40px);
      font-weight: 700;
      text-align: right;
      color: #fff;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .status {
      display: flex;
      justify-content: space-between;
      font-size: clamp(9px, 1.2vh, 11px);
      color: var(--muted);
      margin-top: 4px;
    }

    .lamp {
      width: 6px; height: 6px; border-radius: 50%;
      background: #374151;
      display: inline-block;
      margin-right: 4px;
    }
    .lamp.on { background: var(--success); box-shadow: 0 0 8px var(--success); }

    .keys {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(7, 1fr); /* Force rows to equal height */
      gap: 6px;
      flex: 1; /* Keypad takes remaining space */
      min-height: 0;
    }

    button {
      border: 0;
      border-radius: 8px;
      background: var(--btn);
      color: var(--text);
      font-size: clamp(11px, 2vh, 16px);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.1s;
      box-shadow: 0 2px 0px #1a1d33;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }
    button:hover { filter: brightness(1.2); }
    button:active { transform: translateY(1px); box-shadow: 0 1px 0px #1a1d33; }

    .btn-op { background: #303459; color: #93c5fd; }
    .btn-eq { background: var(--btn-accent); color: #fff; grid-row: span 1; }
    .btn-warn { background: var(--btn-warn); color: #fff; }
    .btn-gray { background: #20233e; color: #9aa0b4; }
    .btn-wide { grid-column: span 2; }

    .side {
      flex: 0 0 240px;
      background: rgba(23, 26, 46, 0.8);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid #242846;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
      height: 100%;
    }

    .list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .chip {
      background: #0d1022;
      border: 1px solid #272b4a;
      border-radius: 6px;
      padding: 6px;
      font-size: 11px;
      flex-shrink: 0;
    }

    .chip-header { color: var(--muted); font-size: 9px; margin-bottom: 2px; }
    .chip-val { font-weight: 700; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .chip-btns { display: flex; gap: 4px; margin-top: 4px; }
    .chip-btns button { padding: 2px 4px; font-size: 9px; box-shadow: none; height: 18px; }

    @media (max-width: 700px) {
      .app { flex-direction: column; }
      .side { flex: 0 0 120px; }
      .keys { grid-template-columns: repeat(6, 1fr); }
    }

    @media (max-height: 500px) {
      .app { padding: 4px; gap: 4px; }
      .calc { padding: 6px; gap: 4px; }
      .side { display: none; } /* Hide history on extremely short screens */
    }
  </style>
</head>
<body>
  <div class="app">
    <main class="calc">
      <div class="screen">
        <div id="exp" class="exp"></div>
        <div id="out" class="out">0</div>
        <div class="status">
          <span><span class="lamp" id="degLamp"></span><span id="modeText">RAD</span></span>
          <span id="memStatus">M: 0</span>
        </div>
      </div>

      <div class="keys" id="keys">
        <button class="btn-warn" data-act="clear">AC</button>
        <button class="btn-gray" data-act="del">DEL</button>
        <button class="btn-gray" data-fn="mod">mod</button>
        <button class="btn-gray" data-num="%">%</button>
        <button class="btn-gray" data-act="mode">R/D</button>
        <button class="btn-gray" data-act="copy">CPY</button>

        <button class="btn-op" data-fn="sin">sin</button>
        <button class="btn-op" data-fn="cos">cos</button>
        <button class="btn-op" data-fn="tan">tan</button>
        <button class="btn-op" data-fn="sqrt">√</button>
        <button class="btn-op" data-fn="ln">ln</button>
        <button class="btn-op" data-fn="log10">log</button>

        <button class="btn-op" data-fn="asin">as</button>
        <button class="btn-op" data-fn="acos">ac</button>
        <button class="btn-op" data-fn="atan">at</button>
        <button class="btn-op" data-fn="pow2">x²</button>
        <button class="btn-op" data-fn="fact">n!</button>
        <button class="btn-op" data-fn="inv">1/x</button>

        <button class="btn-gray" data-act="mc">MC</button>
        <button class="btn-gray" data-act="mr">MR</button>
        <button class="btn-gray" data-act="mplus">M+</button>
        <button class="btn-gray" data-act="ms">MS</button>
        <button class="btn-op" data-fn="pi">π</button>
        <button class="btn-op" data-fn="e">e</button>

        <button data-num="7">7</button>
        <button data-num="8">8</button>
        <button data-num="9">9</button>
        <button class="btn-op" data-op="/">÷</button>
        <button class="btn-op" data-op="*">×</button>
        <button class="btn-op" data-op="^">^</button>

        <button data-num="4">4</button>
        <button data-num="5">5</button>
        <button data-num="6">6</button>
        <button class="btn-op" data-op="-">−</button>
        <button class="btn-op" data-op="+">+</button>
        <button class="btn-gray" data-act="lp">(</button>

        <button data-num="1">1</button>
        <button data-num="2">2</button>
        <button data-num="3">3</button>
        <button class="btn-eq" data-act="eq">=</button>
        <button class="btn-gray" data-act="ans">ANS</button>
        <button class="btn-gray" data-act="rp">)</button>

        <button class="btn-wide" data-num="0">0</button>
        <button data-num=".">.</button>
        <button class="btn-gray" data-act="clearHist">Clear</button>
      </div>
    </main>

    <aside class="side">
      <h3 style="margin:0; font-size: 13px;">History & Memory</h3>
      <div class="list" id="sideList"></div>
    </aside>
  </div>

  <script>
    (() => {
      const expEl = document.getElementById('exp');
      const outEl = document.getElementById('out');
      const sideList = document.getElementById('sideList');
      const modeText = document.getElementById('modeText');
      const degLamp = document.getElementById('degLamp');
      const memStatus = document.getElementById('memStatus');

      let expr = '';
      let lastResult = 0;
      let angleMode = 'RAD';
      let memory = [];
      let history = [];

      const fmt = (n) => {
        if (isNaN(n)) return 'Error';
        if (!isFinite(n)) return 'Inf';
        const s = Number(n.toPrecision(10));
        return parseFloat(s).toLocaleString(undefined, { maximumFractionDigits: 6 });
      };

      const updateUI = () => {
        expEl.textContent = expr || ' ';
        modeText.textContent = angleMode;
        degLamp.classList.toggle('on', angleMode === 'DEG');
        memStatus.textContent = `M: ${memory.length}`;
        renderSide();
      };

      const renderSide = () => {
        let html = '';
        memory.forEach((v, i) => {
          html += `<div class="chip"><div class="chip-header">MEM [${i}]</div><div class="chip-val">${fmt(v)}</div><div class="chip-btns"><button onclick="window.appActions.paste('${v}')">Paste</button><button class="btn-warn" onclick="window.appActions.delMem(${i})">Del</button></div></div>`;
        });
        history.slice().reverse().forEach((item, i) => {
          html += `<div class="chip"><div class="chip-header">${item.exp}</div><div class="chip-val">${fmt(item.res)}</div><div class="chip-btns"><button onclick="window.appActions.reuse('${encodeURIComponent(item.exp)}')">Reuse</button></div></div>`;
        });
        sideList.innerHTML = html || '<p style="color:var(--muted); font-size:10px;">Empty</p>';
      };

      const safeEval = (str) => {
        let t = str.replace(/×/g, '*').replace(/÷/g, '/').replace(/−/g, '-');
        t = t.replace(/\bπ\b/g, `(${Math.PI})`).replace(/\be\b/g, `(${Math.E})`);
        t = t.replace(/(\d|\)|π|e)\s*(\(|sin|cos|tan|asin|acos|atan|ln|log10|sqrt|abs|exp|fact|π|e)/g, '$1*$2');
        t = t.replace(/\^/g, '**').replace(/\bmod\b/g, '%').replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
        const toRad = (x) => angleMode === 'DEG' ? (x * Math.PI / 180) : x;
        const fromRad = (x) => angleMode === 'DEG' ? (x * 180 / Math.PI) : x;
        const factorial = (n) => { if (n < 0) return NaN; if (n === 0) return 1; let r = 1; for (let i = 2; i <= Math.floor(n); i++) r *= i; return r; };
        const ctx = { sin: x => Math.sin(toRad(x)), cos: x => Math.cos(toRad(x)), tan: x => Math.tan(toRad(x)), asin: x => fromRad(Math.asin(x)), acos: x => fromRad(Math.acos(x)), atan: x => fromRad(Math.atan(x)), ln: Math.log, log10: Math.log10, sqrt: Math.sqrt, fact: factorial, inv: x => 1/x, pow2: x => x**2 };
        return new Function(...Object.keys(ctx), `return ${t}`)(...Object.values(ctx));
      };

      const actions = {
        clear: () => { expr = ''; outEl.textContent = '0'; updateUI(); },
        del: () => { expr = expr.slice(0, -1); updateUI(); },
        mode: () => { angleMode = angleMode === 'RAD' ? 'DEG' : 'RAD'; updateUI(); },
        eq: () => {
          if (!expr.trim()) return;
          try {
            const res = safeEval(expr);
            if (isNaN(res)) throw new Error();
            history.push({ exp: expr, res: res });
            if (history.length > 10) history.shift();
            lastResult = res;
            outEl.textContent = fmt(res);
            expr = ''; 
          } catch (e) { outEl.textContent = 'Error'; }
          updateUI();
        },
        mplus: () => { memory.push(lastResult); updateUI(); },
        ms: () => { memory.push(lastResult); updateUI(); },
        mc: () => { memory = []; updateUI(); },
        mr: () => { if(memory.length) expr += memory[memory.length-1]; updateUI(); },
        ans: () => { expr += lastResult; updateUI(); },
        copy: () => { navigator.clipboard.writeText(outEl.textContent); },
        clearHist: () => { history = []; updateUI(); },
        lp: () => { expr += '('; updateUI(); },
        rp: () => { expr += ')'; updateUI(); }
      };

      window.appActions = {
        paste: (v) => { expr += v; updateUI(); },
        delMem: (i) => { memory.splice(i, 1); updateUI(); },
        reuse: (e) => { expr = decodeURIComponent(e); updateUI(); }
      };

      document.getElementById('keys').addEventListener('click', (e) => {
        const b = e.target.closest('button'); if (!b) return;
        const { num, op, fn, act } = b.dataset;
        if (num) expr += num;
        else if (op) expr += ` ${op} `;
        else if (fn) {
          const d = { pi: 'π', e: 'e' };
          const w = { fact: 'fact(', sin: 'sin(', cos: 'cos(', tan: 'tan(', sqrt: 'sqrt(', ln: 'ln(', log10: 'log10(', asin: 'asin(', acos: 'acos(', atan: 'atan(', pow2: 'pow2(', inv: 'inv(', mod: ' mod ' };
          expr += d[fn] || w[fn] || '';
        }
        else if (act && actions[act]) actions[act]();
        updateUI();
      });

      updateUI();
    })();
  </script>
</body>
</html>